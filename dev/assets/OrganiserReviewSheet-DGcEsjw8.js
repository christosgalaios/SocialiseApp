import{a as o,j as e,A as z,m as w}from"./vendor-motion-CtvpaCTF.js";import{a as p,o as A,G as F,I as D,J as P,s as f,X as $,j as v,Q as G,h as L,S as Y,Y as B,t as g,m as U}from"./index-MqbGuJyu.js";import"./vendor-maps-DdmUqcD-.js";function q(){const t=p(s=>s.showOrganiserReview),j=p(s=>s.setShowOrganiserReview),c=p(s=>s.showToast),x=A(s=>s.user),[r,b]=o.useState([]),[u,y]=o.useState(""),[l,d]=o.useState(!1),[m,N]=o.useState(null),[S,h]=o.useState(!0),i=()=>{B(),j(null)};F(!!t,i);const R=D(!!t),{sheetY:k,dragZoneProps:T}=P(i);o.useEffect(()=>{if(!t?.organiserId||!x?.id){h(!1);return}let s=!1;return h(!0),f.getOrganiserReviews(t.organiserId).then(a=>{if(s)return;const n=a.reviews?.find(E=>E.reviewerId===x.id);n&&(N(n),b(n.tags||[]),y(n.comment||""))}).catch(()=>{}).finally(()=>{s||h(!1)}),()=>{s=!0}},[t?.organiserId,x?.id]);const C=s=>{v(),g(),b(a=>a.includes(s)?a.filter(n=>n!==s):a.length<5?[...a,s]:a)},I=async()=>{if(!(r.length===0||l)){d(!0);try{await f.submitOrganiserReview(t.organiserId,{tags:r,comment:u.trim()}),U(),g(),c(m?"Review updated!":"Review submitted!","success"),i()}catch(s){c(s.message||"Failed to submit review","error")}finally{d(!1)}}},O=async()=>{if(!l){d(!0);try{await f.deleteOrganiserReview(t.organiserId),g(),c("Review removed","info"),i()}catch(s){c(s.message||"Failed to delete review","error")}finally{d(!1)}}};return t?e.jsx(z,{children:t&&e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[110] bg-secondary/60 backdrop-blur-sm flex items-end md:items-center justify-center",onPointerDown:s=>{s.target===s.currentTarget&&i()},children:e.jsxs(w.div,{ref:R,initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:400},style:{y:k},className:"bg-paper rounded-t-[32px] md:rounded-[32px] w-full md:max-w-md max-h-[80vh] overflow-hidden flex flex-col",role:"dialog","aria-modal":"true","aria-label":`Review ${t.organiserName||"organiser"}`,children:[e.jsx("div",{...T,className:"flex justify-center pt-3 pb-2 cursor-grab active:cursor-grabbing",children:e.jsx("div",{className:"w-10 h-1 bg-secondary/20 rounded-full"})}),e.jsxs("div",{className:"px-6 pb-4 flex items-center justify-between border-b border-secondary/10",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-black text-secondary",children:m?"Edit Your Review":"Leave a Review"}),e.jsxs("p",{className:"text-[11px] text-secondary/40 font-medium mt-0.5",children:["How was your experience with ",t.organiserName||"this organiser","?"]})]}),e.jsx("button",{onPointerDown:()=>{v(),i()},className:"w-10 h-10 rounded-full bg-secondary/10 flex items-center justify-center","aria-label":"Close",children:e.jsx($,{size:20,className:"text-secondary/60"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",style:{overscrollBehavior:"contain"},children:S?e.jsxs("div",{className:"space-y-3 animate-pulse",children:[e.jsx("div",{className:"h-4 w-32 bg-secondary/10 rounded-full"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"h-10 w-24 bg-secondary/10 rounded-full"},s))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-xs font-black text-primary uppercase tracking-widest",children:["Vibe Tags",e.jsx("span",{className:"text-accent",children:"."})]}),e.jsxs("span",{className:`text-[10px] font-bold ${r.length>0?"text-primary":"text-secondary/30"}`,children:[r.length,"/5 selected"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:G.map(s=>{const a=r.includes(s.id);return e.jsxs("button",{type:"button",onClick:()=>C(s.id),className:`inline-flex items-center gap-1.5 px-3.5 py-2 rounded-full text-xs font-bold border transition-all active:scale-95 ${a?`${s.color} ring-2 ring-primary/20 shadow-sm`:"bg-secondary/5 text-secondary/50 border-secondary/10 hover:bg-secondary/10"}`,children:[a&&e.jsx(L,{size:12,strokeWidth:3}),e.jsx("span",{children:s.emoji}),s.label]},s.id)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"text-xs font-black text-primary uppercase tracking-widest",children:["Comment",e.jsx("span",{className:"text-accent",children:"."})]}),e.jsx("span",{className:"text-[10px] text-secondary/30 font-medium",children:"Optional"})]}),e.jsx("textarea",{value:u,onChange:s=>y(s.target.value),placeholder:"Share a quick thought about this organiser...",maxLength:200,rows:3,className:"w-full bg-secondary/5 border border-secondary/10 rounded-2xl px-4 py-3 text-sm font-medium focus:outline-none focus:border-primary transition-all placeholder:text-secondary/30 text-[var(--text)] resize-none break-words",style:{overflowWrap:"break-word"}}),e.jsxs("p",{className:"text-[10px] text-secondary/30 font-medium mt-1 text-right",children:[u.length,"/200"]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-secondary/10 pb-[max(24px,env(safe-area-inset-bottom))] flex gap-3",children:[m&&e.jsx("button",{onClick:O,disabled:l,className:"px-4 py-3 rounded-2xl bg-red-500/10 text-red-600 text-sm font-bold border border-red-500/20 hover:bg-red-500/20 transition-colors disabled:opacity-50",children:"Remove"}),e.jsx("button",{onClick:I,disabled:r.length===0||l,className:"flex-1 py-3.5 rounded-2xl font-black text-sm flex items-center justify-center gap-2 transition-all active:scale-[0.98] disabled:opacity-40 disabled:cursor-not-allowed bg-gradient-to-r from-primary to-accent text-white shadow-lg",children:l?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:16}),m?"Update Review":"Submit Review"]})})]})]})})}):null}export{q as default};
