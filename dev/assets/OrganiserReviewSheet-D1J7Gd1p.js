import{a as o,j as e,A as $,m as v}from"./vendor-motion-CtvpaCTF.js";import{a as h,o as D,F,G as z,I as A,s as b,X as P,j as w,Q as G,h as L,S as Y,Y as B,t as p,m as U}from"./index-CJHyHtDW.js";import"./vendor-maps-DdmUqcD-.js";function q(){const a=h(s=>s.showOrganiserReview),j=h(s=>s.setShowOrganiserReview),d=h(s=>s.showToast),x=D(s=>s.user),[r,g]=o.useState([]),[i,y]=o.useState(""),[c,m]=o.useState(!1),[u,N]=o.useState(null),[S,f]=o.useState(!0),n=()=>{B(),j(null)};F(!!a,n);const R=z(!!a),{sheetY:k,dragZoneProps:T}=A(n);o.useEffect(()=>{if(!a?.organiserId||!x?.id){f(!1);return}let s=!1;return f(!0),b.getOrganiserReviews(a.organiserId).then(t=>{if(s)return;const l=t.reviews?.find(E=>E.reviewerId===x.id);l&&(N(l),g(l.tags||[]),y(l.comment||""))}).catch(()=>{}).finally(()=>{s||f(!1)}),()=>{s=!0}},[a?.organiserId,x?.id]);const C=s=>{w(),p(),g(t=>t.includes(s)?t.filter(l=>l!==s):t.length<5?[...t,s]:t)},I=async()=>{if(!(r.length===0||c)){m(!0);try{await b.submitOrganiserReview(a.organiserId,{tags:r,comment:i.trim()}),U(),p(),d(u?"Review updated!":"Review submitted!","success"),n()}catch(s){d(s.message||"Failed to submit review","error")}finally{m(!1)}}},O=async()=>{if(!c){m(!0);try{await b.deleteOrganiserReview(a.organiserId),p(),d("Review removed","info"),n()}catch(s){d(s.message||"Failed to delete review","error")}finally{m(!1)}}};return a?e.jsx($,{children:a&&e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[110] bg-secondary/60 backdrop-blur-sm flex items-end md:items-center justify-center",onPointerDown:s=>{s.target===s.currentTarget&&n()},children:e.jsxs(v.div,{ref:R,initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:400},style:{y:k},className:"bg-paper rounded-t-[32px] md:rounded-[32px] w-full md:max-w-md max-h-[80vh] overflow-hidden flex flex-col",role:"dialog","aria-modal":"true","aria-label":`Review ${a.organiserName||"organiser"}`,children:[e.jsx("div",{...T,className:"flex justify-center pt-3 pb-2 cursor-grab active:cursor-grabbing",children:e.jsx("div",{className:"w-10 h-1 bg-secondary/20 rounded-full"})}),e.jsxs("div",{className:"px-6 pb-4 flex items-center justify-between border-b border-secondary/10",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-black text-secondary",children:u?"Edit Your Review":"Leave a Review"}),e.jsxs("p",{className:"text-[11px] text-secondary/40 font-medium mt-0.5",children:["How was your experience with ",a.organiserName||"this organiser","?"]})]}),e.jsx("button",{onPointerDown:()=>{w(),n()},className:"w-10 h-10 rounded-full bg-secondary/10 flex items-center justify-center hover:bg-secondary/20 transition-colors focus-visible:ring-2 focus-visible:ring-primary/30 focus-visible:outline-none","aria-label":"Close",children:e.jsx(P,{size:20,className:"text-secondary/60"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",style:{overscrollBehavior:"contain"},children:S?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 w-32 bg-secondary/10 rounded-full animate-pulse"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"h-10 w-24 bg-secondary/10 rounded-full animate-pulse",style:{animationDelay:`${s*.08}s`}},s))}),e.jsx("div",{className:"h-4 w-24 bg-secondary/10 rounded-full animate-pulse",style:{animationDelay:"0.5s"}}),e.jsx("div",{className:"h-20 bg-secondary/10 rounded-2xl animate-pulse",style:{animationDelay:"0.6s"}})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-xs font-black text-primary uppercase tracking-widest",children:["Vibe Tags",e.jsx("span",{className:"text-accent",children:"."})]}),e.jsxs("span",{className:`text-[10px] font-bold transition-colors ${r.length>0?"text-primary":"text-secondary/30"}`,children:[r.length,"/5 selected"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:G.map(s=>{const t=r.includes(s.id);return e.jsxs("button",{type:"button",onClick:()=>C(s.id),className:`inline-flex items-center gap-1.5 px-3.5 py-2 rounded-full text-xs font-bold border transition-all active:scale-95 focus-visible:ring-2 focus-visible:ring-primary/30 focus-visible:outline-none ${t?`${s.color} ring-2 ring-primary/20 shadow-sm`:"bg-secondary/5 text-secondary/50 border-secondary/10 hover:bg-secondary/10"}`,children:[t&&e.jsx(L,{size:12,strokeWidth:3}),e.jsx("span",{children:s.emoji}),s.label]},s.id)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"text-xs font-black text-primary uppercase tracking-widest",children:["Comment",e.jsx("span",{className:"text-accent",children:"."})]}),e.jsx("span",{className:"text-[10px] text-secondary/30 font-medium",children:"Optional"})]}),e.jsx("textarea",{value:i,onChange:s=>y(s.target.value),placeholder:"Share a quick thought about this organiser...",maxLength:200,rows:3,className:"w-full bg-secondary/5 border border-secondary/10 rounded-2xl px-4 py-3 text-sm font-medium focus:outline-none focus:border-primary hover:border-secondary/20 transition-all placeholder:text-secondary/30 text-[var(--text)] resize-none break-words",style:{overflowWrap:"break-word"}}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex-1 h-0.5 bg-secondary/10 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-200 ${i.length>180?"bg-amber-500/60":"bg-primary/40"}`,style:{width:`${Math.min(i.length/200*100,100)}%`}})}),e.jsxs("span",{className:`text-[10px] font-bold ${i.length>180?"text-amber-500":"text-secondary/30"}`,children:[i.length,"/200"]})]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-secondary/10 pb-[max(24px,env(safe-area-inset-bottom))] flex gap-3",children:[u&&e.jsx("button",{onClick:O,disabled:c,className:"px-4 py-3 rounded-2xl bg-red-500/10 text-red-600 text-sm font-bold border border-red-500/20 hover:bg-red-500/20 transition-colors disabled:opacity-50 focus-visible:ring-2 focus-visible:ring-red-500/30 focus-visible:outline-none",children:"Remove"}),e.jsx("button",{onClick:I,disabled:r.length===0||c,className:"flex-1 py-3.5 rounded-2xl font-black text-sm flex items-center justify-center gap-2 transition-all active:scale-[0.98] disabled:opacity-40 disabled:cursor-not-allowed bg-gradient-to-r from-primary to-accent text-white shadow-lg focus-visible:ring-2 focus-visible:ring-primary/30 focus-visible:outline-none",children:c?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:16}),u?"Update Review":"Submit Review"]})})]})]})})}):null}export{q as default};
